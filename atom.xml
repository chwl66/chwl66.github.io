<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://chwl66.github.io</id>
    <title>温故知新</title>
    <updated>2019-12-25T08:34:40.260Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://chwl66.github.io"/>
    <link rel="self" href="https://chwl66.github.io/atom.xml"/>
    <subtitle>温故而知新</subtitle>
    <logo>https://chwl66.github.io/images/avatar.png</logo>
    <icon>https://chwl66.github.io/favicon.ico</icon>
    <rights>All rights reserved 2019, 温故知新</rights>
    <entry>
        <title type="html"><![CDATA[WordPress编辑器中添加“上传到Chevereto图床”按钮]]></title>
        <id>https://chwl66.github.io/post/FNHwd2cm5</id>
        <link href="https://chwl66.github.io/post/FNHwd2cm5">
        </link>
        <updated>2019-12-01T15:20:04.000Z</updated>
        <content type="html"><![CDATA[<p>前段时间搭建了 Chevereto 图床，但在 WordPress 编辑器里需要上传图片的时候，需要另外打开图床上传比较麻烦。这时候可以在 WordPress 的编辑器里添加个上传按钮，利用 API 上传到 Chevereto 图床，这样上传图片到图床就方便啦！</p>
<figure data-type="image" tabindex="1"><img src="https://s2.ax1x.com/2019/12/01/Qmrvq0.png" alt="Qmrvq0.png"></figure>
<p>下面我把详细啊方法记录一下：</p>
<h3 id="chevereto">Chevereto</h3>
<p>获取 API KEY: 登录，转到 <code>仪表盘-设置-API</code>，将  <code>API v1 key</code>  记录下来;</p>
<p>API 后端设置: 进入 Chevereto 的安装目录，将 <code>app/routes/route.api.php</code> 文件拷贝到 <code>app/routes/overrides/route.api.php</code> 文件;</p>
<p>允许跨域: 打开 <code>app/routes/overrides/route.api.php</code>，添加</p>
<pre><code>header('Access-Control-Allow-Origin: https://spiritx.xyz');
header('Access-Control-Allow-Methods: POST');
header('Access-Control-Allow-Headers: Content-Type, Accept, Authorization, X-Requested-With, Origin, Accept');
</code></pre>
<p>记得把白名单 <code>https://spiritx.xyz</code> 改成自己的域名或者改成* （所有域名可用）；</p>
<p>设置 API user(可选): 在 <code>app/routes/overrides/route.api.php</code> 中，找到<code>$uploaded_id = CHV\Image::uploadToWebsite($source);</code>那一行，更改为</p>
<pre><code>$uploaded_id = CHV\Image::uploadToWebsite($source,admin);
</code></pre>
<p>将 admin 替换为图床中的用户;</p>
<h3 id="wordpress-53版本以下用">WordPress 5.3版本以下用</h3>
<p>前端添加上传按钮(media button)： 将以下代码添加到<a href="https://www.yunloc.com/tag/wordpress">WordPress</a>正在使用的主题目录的 functions.php 中</p>
<pre><code>//添加图床上传按钮
add_action('media_buttons', 'add_my_media_button');
function add_my_media_button() {
    $currentUser = wp_get_current_user();
        if(!empty($currentUser-&gt;roles) &amp;&amp; in_array('administrator', $currentUser-&gt;roles)){
            $DOMAIN=&quot;图床的域名&quot;;
            $APIkey=&quot;图床的API v1 key&quot;;// 是管理员
        }
        else
            return 0;  // 非管理员
    echo '
            &lt;input id=&quot;up_to_chevereto&quot; type=&quot;file&quot; accept=&quot;image/*&quot; multiple=&quot;multiple&quot;/&gt;
            &lt;label for=&quot;up_to_chevereto&quot; id=&quot;up_img_label&quot;&gt;&lt;i class=&quot;fa fa-picture-o&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; 上传图片到Chevereto&lt;/label&gt;
          ';
?&gt;
&lt;style type=&quot;text/css&quot;&gt;
#up_to_chevereto {
  display: none;
}
#up_img_label {
  color: #fff;
  background-color: #16a085;
  border-radius: 5px;
  display: inline-block;
  padding: 5.2px;
}
&lt;/style&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
$('#up_to_chevereto').change(function() {
  window.wpActiveEditor = null;
  for (var i = 0; i &lt; this.files.length; i++) {
    var f=this.files[i];
    var formData=new FormData();
    formData.append('source',f);
    $.ajax({
        async:true,
        crossDomain:true,
        url:'https://&lt;?php echo $DOMAIN; ?&gt;/api/1/upload/?key=&lt;?php echo $APIkey; ?&gt;&amp;format=json',
        type : 'POST',
        processData : false,
        contentType : false,
        data:formData,
        beforeSend: function (xhr) {
            $('#up_img_label').html('&lt;i class=&quot;fa fa-spinner rotating&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; Uploading...');
        },
        success:function(res){
            wp.media.editor.insert('&lt;a href='+res.image.url+'&gt;&lt;img src='+res.image.url+' alt='+res.image.title+'&gt;&lt;/img&gt;&lt;/a&gt;');
            $(&quot;#up_img_label&quot;).html('&lt;i class=&quot;fa fa-check&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; 上传成功,继续上传');
        },
        error: function (){
            $(&quot;#up_img_label&quot;).html('&lt;i class=&quot;fa fa-times&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; 上传失败，重新上传');
        }
    });
  }
});
&lt;/script&gt;
&lt;?php
}
</code></pre>
<h3 id="wordpress-53版本用">WordPress 5.3版本用</h3>
<pre><code>//添加图床上传按钮
add_action('media_buttons', 'add_my_media_button');
function add_my_media_button() {
    $currentUser = wp_get_current_user();
        if(!empty($currentUser-&gt;roles) &amp;&amp; in_array('administrator', $currentUser-&gt;roles)){
            $DOMAIN=&quot;图床的域名&quot;;
            $APIkey=&quot;图床的API v1 key&quot;;// 是管理员
        }
        else
            return 0;  // 非管理员
    echo '
            &lt;input id=&quot;up_to_chevereto&quot; type=&quot;file&quot; accept=&quot;image/*&quot; multiple=&quot;multiple&quot;/&gt;
            &lt;label for=&quot;up_to_chevereto&quot; id=&quot;up_img_label&quot;&gt;&lt;i class=&quot;fa fa-picture-o&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; 上传图片到Chevereto&lt;/label&gt;
          ';
?&gt;
&lt;style type=&quot;text/css&quot;&gt;
#up_to_chevereto {
  display: none;
}
#up_img_label {
  color: #fff;
  background-color: #16a085;
  border-radius: 5px;
  display: inline-block;
  padding: 5.2px;
}
&lt;/style&gt;
&lt;script type=&quot;text/javascript&quot;&gt;
jQuery('#up_to_chevereto').change(function() {
  window.wpActiveEditor = null;
  for (var i = 0; i &lt; this.files.length; i++) {
    var f=this.files[i];
    var formData=new FormData();
    formData.append('source',f);
    jQuery.ajax({
        async:true,
        crossDomain:true,
        url:'https://&lt;?php echo $DOMAIN; ?&gt;/api/1/upload/?key=&lt;?php echo $APIkey; ?&gt;&amp;format=json',
        type : 'POST',
        processData : false,
        contentType : false,
        data:formData,
        beforeSend: function (xhr) {
            jQuery('#up_img_label').html('&lt;i class=&quot;fa fa-spinner rotating&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; Uploading...');
        },
        success:function(res){
            wp.media.editor.insert('&lt;a href='+res.image.url+'&gt;&lt;img src='+res.image.url+' alt='+res.image.title+'&gt;&lt;/img&gt;&lt;/a&gt;');
            jQuery(&quot;#up_img_label&quot;).html('&lt;i class=&quot;fa fa-check&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; 上传成功,继续上传');
        },
        error: function (){
            jQuery(&quot;#up_img_label&quot;).html('&lt;i class=&quot;fa fa-times&quot; aria-hidden=&quot;true&quot;&gt;&lt;/i&gt; 上传失败，重新上传');
        }
    });
  }
});
&lt;/script&gt;
&lt;?php
}
</code></pre>
<p>style里的样式可以根据自己偏好自定义</p>
<h3 id="使用预览">使用预览</h3>
<p>这里我的编辑器用的是WP Editor.md，界面不同但不影响上传按钮的使用</p>
<figure data-type="image" tabindex="2"><img src="https://s2.ax1x.com/2019/12/01/QmrzZV.gif" alt="QmrzZV.gif"></figure>
<h4 id="文章引用至-spirit的小站-转载请注明出处">文章引用至 <a href="https://spiritx.xyz/843.html">spirit的小站</a> 转载请注明出处！</h4>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[typecho在后台增加图床上传图片按钮]]></title>
        <id>https://chwl66.github.io/post/Y80xYA7z9</id>
        <link href="https://chwl66.github.io/post/Y80xYA7z9">
        </link>
        <updated>2019-11-30T15:52:32.000Z</updated>
        <content type="html"><![CDATA[<h4 id="路过图床"><a href="https://imgse.com/">路过图床</a>是一个不错的图床网站，图片放到图床将有效缓解网站服务器带宽和存储空间的压力</h4>
<h4 id="官方提供的插件代码支持的网站程序很多如下图">官方提供的插件代码支持的网站程序很多，如下图</h4>
<figure data-type="image" tabindex="1"><a href="https://s2.ax1x.com/2019/12/02/Qmhx1K.png"><img src="https://s2.ax1x.com/2019/12/02/Qmhx1K.png" alt="路过图床1.png"></a></figure>
<h4 id="其中并未显示支持typecho所以我们需要稍作修改下面是修改好的代码">其中并未显示支持typecho，所以我们需要稍作修改，下面是修改好的代码</h4>
<pre><code>&lt;script async id=&quot;chevereto-pup-src&quot; src=&quot;https://imgse.com/sdk/pup.js&quot; data-url=&quot;https://imgse.com/upload&quot; data-auto-insert=&quot;markdown-embed&quot;&gt;&lt;/script&gt;
</code></pre>
<h4 id="将代码放到需要上传图片的文件内一般放在footerphp的body之前">将代码放到需要上传图片的文件内，一般放在footer.php的</body>之前</h4>
<p>如果要实现后台上传图片，则需要在typecho的安装目录admin/footer.php里增加以上代码</p>
<figure data-type="image" tabindex="2"><a href="https://s2.ax1x.com/2019/12/02/Qm4C0H.png"><img src="https://s2.ax1x.com/2019/12/02/Qm4C0H.png" alt="路过图床2.png"></a></figure>
<h4 id="设置好之后后台编辑框出现如下效果">设置好之后后台编辑框出现如下效果</h4>
<figure data-type="image" tabindex="3"><a href="https://s2.ax1x.com/2019/12/02/Qm4P7d.png"><img src="https://s2.ax1x.com/2019/12/02/Qm4P7d.png" alt="路过图床3.png"></a></figure>
<h4 id="上传完成后markdown格式的代码会自动出现在编辑框里插入图片的操作将会非常方便">上传完成后markdown格式的代码会自动出现在编辑框里，插入图片的操作将会非常方便</h4>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[WordPress采集插件]]></title>
        <id>https://chwl66.github.io/post/DmB2y0jPB</id>
        <link href="https://chwl66.github.io/post/DmB2y0jPB">
        </link>
        <updated>2019-11-28T17:16:02.000Z</updated>
        <content type="html"><![CDATA[<p><strong>简介</strong>如何安装下载插件长腿蜘蛛-CTspider 然后到WordPress插件页面点击上传，安装启用即可。 如果使用FTP上传,请使用二进制上传协议。如何授权登录长腿蜘蛛-CTspider官网注册账号（P</p>
<h2 id="如何安装">如何安装</h2>
<p>下载插件<a href="https://www.ctspider.com/">长腿蜘蛛-CTspider</a></p>
<ol>
<li>然后到WordPress插件页面点击上传，安装启用即可。</li>
<li>如果使用FTP上传,请使用二进制上传协议。</li>
</ol>
<h2 id="如何授权">如何授权</h2>
<p>登录<a href="https://www.ctspider.com/">长腿蜘蛛-CTspider</a>官网注册账号（PS：注册账号需要邮箱验证激活码，请认真填写邮箱账号）。</p>
<ol>
<li>点击用户中心-&gt;添加授权域名（PS：目前每位用户可以授权3个域名）。</li>
<li>得到授权码后，点击CTspider插件-&gt;系统配置-&gt;授权码配置-&gt;填入授权码-&gt;保存配置-&gt;验证授权</li>
</ol>
<figure data-type="image" tabindex="1"><img src="https://www.ctspider.com/wp-content/uploads/2018/08/%E6%8E%88%E6%9D%83.png" alt="img"></figure>
<h2 id="最近有很多网友问为什么点击采集后显示没有任何数据只有两种可能">最近有很多网友问：为什么点击采集后显示没有任何数据只有两种可能</h2>
<ol>
<li>采集规则没有设置好。</li>
<li>如果确定采集规则没问题，请查看当前采集的网址是否是Ajax动态渲染加载（PS：目前长腿蜘蛛-CTspider <code>不支持动态渲染加载采集</code>）</li>
</ol>
<h2 id="新建项目-基本配置">新建项目 / 基本配置</h2>
<p>接下来我们详细说下如何采集一个项目</p>
<p>我们使用新浪科技为示例：</p>
<p>首先基本配置</p>
<ol>
<li>任务名称：新浪科技（PS：自定义即可）</li>
<li>更新时间：默认60分钟（PS：当前任务60分钟自动执行一次）</li>
<li>字符集：默认选项就可以（PS：如果出现乱码情况，请针对当前web网页字符集选择即可）</li>
<li>随机IP：开启（PS：开启随机IP会在每次采集的时候自动更换IP,减少服务器IP被封的几率）</li>
<li>多线程采集：开启 （PS：开启后可提高采集速度）</li>
<li>多线程数量：默认10（PS：根据自己服务器配置酌情使用）</li>
</ol>
<figure data-type="image" tabindex="2"><img src="https://www.ctspider.com/wp-content/uploads/2018/08/%E5%9F%BA%E6%9C%AC%E8%AE%BE%E7%BD%AE.png" alt="img"></figure>
<h2 id="列表设置">列表设置</h2>
<ul>
<li>列表URL: http://roll.tech.sina.com.cn/internet_all/index.shtml （PS：如需多个，可换行添加）</li>
<li>列表区域选择器：<code>.contList&gt;ul&gt;li</code> （PS：【<code>完全和CSS选择器用法一样</code>】【<code>可填，可不填</code>】如果采集当前页面有多个相同列表DOM节点就要填写，确保采集精准度）用谷歌浏览器右键审查元素，可以看出当前列表数据都在<code>.contList&gt;ul&gt;li</code>下面</li>
</ul>
<figure data-type="image" tabindex="3"><img src="https://www.ctspider.com/wp-content/uploads/2018/08/URLcss_2.png" alt="img"></figure>
<ul>
<li>列表缩略图：如果有图可以直接填写当前缩略图CSS选择器</li>
<li>文章网址匹配：<code>a</code> （PS：由于上面区域选择器已经定位,我们可以直接填入<code>a标签</code>即可，如果区域选择器没有定位则设置：<code>.contList li a</code> 或者<code>.contList a</code> 具体根据你采集页面dom结构自己分析）</li>
<li>添加来源网址到自定义字段：<code>source_url</code>（PS：【自定义】可开启或不开启，设置后会在每天文章添加一个自定义字段<code>source_url</code>并且会把当前采集到网址链接赋值给该字段用于前台调用显示）如: <code>get_post_meta('source_url')</code> 可调用该字段的值。</li>
</ul>
<h3 id="点击列表测试可以查看当前项目列表配置情况"><strong>点击列表测试可以查看当前项目列表配置情况</strong></h3>
<figure data-type="image" tabindex="4"><img src="https://www.ctspider.com/wp-content/uploads/2018/08/%E5%88%97%E8%A1%A8%E6%B5%8B%E8%AF%95.png" alt="img"></figure>
<h2 id="文章设置">文章设置</h2>
<p>标题匹配规则：<code>h1</code></p>
<p>文章内容设置：<code>#article_content</code></p>
<figure data-type="image" tabindex="5"><img src="https://www.ctspider.com/wp-content/uploads/2018/08/%E6%96%87%E7%AB%A0_2.png" alt="img"></figure>
<p>可以看到标题在<code>h1</code>标签下，也可使用<code>.main-title</code>来获取标题</p>
<p>正文内容看上去有好多 <code>class和id</code> 如果有id属性尽量采用id，毕竟id是唯一性，定位精准。</p>
<p>我们还可以增加规则来采集<code>TAG标签</code></p>
<p>长腿蜘蛛-CTspider 提供了6总规则添加采集，并且可以自定义字段规则（PS：自定义字段规则可以添加多个）</p>
<figure data-type="image" tabindex="6"><img src="https://www.ctspider.com/wp-content/uploads/2018/08/%E6%96%87%E7%AB%A0%E8%A7%84%E5%88%99.png" alt="img"></figure>
<h3 id="点击采集测试"><strong>点击采集测试</strong></h3>
<p>采集结果完美呈现（原文：标题：TAG）正确显示</p>
<p>但是我们发现结果中出现了<code>a链接</code>和一些多于的<code>css属性</code>和<code>id属性</code>还有<code>span标签</code></p>
<figure data-type="image" tabindex="7"><img src="https://www.ctspider.com/wp-content/uploads/2018/08/%E9%87%87%E9%9B%86%E6%B5%8B%E8%AF%95.png" alt="img"></figure>
<p><strong>我们可以利用<code>长腿蜘蛛-CTspider</code>强大的<code>内容过滤</code>模块进行数据清洗工作</strong></p>
<h2 id="内容过滤">内容过滤</h2>
<ol>
<li>首先删除数据中所有<code>a链接</code>但不删除a标签内容</li>
<li>删除数据中<code>span标签</code>并且也不删除内容</li>
<li>删除数据中无用的<code>class</code>属性和<code>id</code>属性</li>
</ol>
<h3 id="具体设置如下图"><strong>具体设置如下图：</strong></h3>
<figure data-type="image" tabindex="8"><img src="https://www.ctspider.com/wp-content/uploads/2018/08/%E8%BF%87%E6%BB%A4.png" alt="img"></figure>
<h2 id="最后在进行采集测试得到纯净的数据">最后在进行采集测试（得到纯净的数据）</h2>
<figure data-type="image" tabindex="9"><img src="https://www.ctspider.com/wp-content/uploads/2018/08/%E9%87%87%E9%9B%86%E6%B5%8B%E8%AF%952.png" alt="img"></figure>
<p>接代写规则，出已有规则，有意者私聊。<br>
<img src="https://ravpf.cn/d/file/p/2019/11-23/c7f4e20fbf5bbf51b7347711cd83bca9.png" alt="img"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[【神器】使用Folderclone秒转网友Google Drive分享文件到自己的Google Drive网盘]]></title>
        <id>https://chwl66.github.io/post/d8paPRJx0</id>
        <link href="https://chwl66.github.io/post/d8paPRJx0">
        </link>
        <updated>2019-11-26T18:39:03.000Z</updated>
        <content type="html"><![CDATA[<h2 id="关于folderclone">关于Folderclone</h2>
<blockquote>
<p><code>Folderclone</code>，增加了服务帐户的团队成员和上载数据TB的，在使用某种算法每个服务帐户（<code>750GB</code> /天）的载配额。基本上我们可以通过一个项目在团队网盘中添加<code>100</code>个服务帐户。因此，每天可以复制的最大数据是每个项目最大<code>750GB</code> * <code>100</code> = <code>75TB</code>（每天）。</p>
</blockquote>
<p>首先计算您每天要复制的数据大小，取决于创建的项目数量。每个项目最多可以创建<code>100</code>个服务帐户。所以每个项目的复制容量是<code>75tb</code>。复制需要至少<code>2</code>个项目。</p>
<p><strong>详情请查看：</strong></p>
<blockquote>
<p>https://github.com/Spazzlo/folderclone<br>
https://github.com/SameerkumarP/Multifolderclone<br>
https://blackpearl.biz/threads/7408/<br>
https://blackpearl.biz/threads/7892/</p>
</blockquote>
<h2 id="新建项目">新建项目</h2>
<p>在<code>Google</code>云端控制台上设置<code>2</code>个项目点击<a href="https://console.developers.google.com/">此处</a> 在【<code>**Google Cloud Platform**</code>】 【<strong>服务条款</strong>】中勾选【<strong>同意并继续</strong>】</p>
<figure data-type="image" tabindex="1"><a href="https://52mip.com/usr/uploads/2019/09/3101688677.png"><img src="https://52mip.com/usr/uploads/2019/09/3101688677.png" alt="1.png"></a></figure>
<p>我们必须创建<code>2</code>个新项目，项目名称随便，例如这里设置的项目名称是“<code>foldercloneA</code>”和“<code>foldercloneB</code>”。</p>
<h2 id="新建项目folderclonea">新建项目foldercloneA</h2>
<p>在Google云端控制台 【<strong>选择项目</strong>】【<strong>新建项目</strong>】<br>
<a href="https://52mip.com/usr/uploads/2019/09/4083586491.png"><img src="https://52mip.com/usr/uploads/2019/09/4083586491.png" alt="2.png"></a><br>
<a href="https://52mip.com/usr/uploads/2019/09/3326266508.png"><img src="https://52mip.com/usr/uploads/2019/09/3326266508.png" alt="3.png"></a></p>
<p>在【<strong>API和服务</strong>】【<strong>库</strong>】里面搜索【<code>**Google Drive API**</code>】和【<code>**Identity and Access Management (IAM) API**</code>】并启用它们。<br>
<a href="https://52mip.com/usr/uploads/2019/09/3669283620.png"><img src="https://52mip.com/usr/uploads/2019/09/3669283620.png" alt="apis.png"></a></p>
<p>【<strong>导航菜单</strong>】【<strong>IAM和管理</strong>】【<code>**IAM**</code>】<br>
<a href="https://52mip.com/usr/uploads/2019/09/2920108775.png"><img src="https://52mip.com/usr/uploads/2019/09/2920108775.png" alt="apis1.png"></a></p>
<p>【<strong>服务账号</strong>】【<strong>创建服务账号</strong>】<br>
<a href="https://52mip.com/usr/uploads/2019/09/2956986365.png"><img src="https://52mip.com/usr/uploads/2019/09/2956986365.png" alt="apis2.png"></a></p>
<p>【<strong>服务帐号详情</strong>】【<strong>服务帐号名称</strong>】随便填 比如这里填写的是：<br>
<a href="https://52mip.com/usr/uploads/2019/09/3485192594.png"><img src="https://52mip.com/usr/uploads/2019/09/3485192594.png" alt="iam_admin_serviceaccounts.png"></a></p>
<p>【<strong>服务帐号权限（可选）</strong>】【<strong>请选择一个角色</strong>】【<code>**Project**</code>】【<strong>所有者</strong>】<br>
<a href="https://52mip.com/usr/uploads/2019/09/1840329678.png"><img src="https://52mip.com/usr/uploads/2019/09/1840329678.png" alt="iam_admin_serviceaccounts1.png"></a></p>
<p>【<strong><code>+</code>添加其它角色</strong>】<br>
<a href="https://52mip.com/usr/uploads/2019/09/41081976.png"><img src="https://52mip.com/usr/uploads/2019/09/41081976.png" alt="iam_admin_serviceaccounts2.png"></a></p>
<p>【<strong>请选择一个角色</strong>】【<strong><code>Service Accounts</code></strong>】【<strong><code>Service Account Admin</code></strong>】<br>
<a href="https://52mip.com/usr/uploads/2019/09/2750924325.png"><img src="https://52mip.com/usr/uploads/2019/09/2750924325.png" alt="iam_admin_serviceaccounts3.png"></a></p>
<p><code>2</code>个角色【<strong><code>Project</code>-所有者</strong>】和【<strong><code>Service Account Admin</code></strong>】【<strong>继续</strong>】<br>
<a href="https://52mip.com/usr/uploads/2019/09/1602555657.png"><img src="https://52mip.com/usr/uploads/2019/09/1602555657.png" alt="iam_admin_serviceaccounts4.png"></a></p>
<p>【<strong>创建密钥</strong>】【<strong>密钥类型</strong>】选择默认的【<strong><code>JSON</code></strong>】【<strong>创建</strong>】<br>
<a href="https://52mip.com/usr/uploads/2019/09/2082809350.png"><img src="https://52mip.com/usr/uploads/2019/09/2082809350.png" alt="iam_admin_serviceaccounts5.png"></a></p>
<p>私钥已保存到您的计算机<code>folderclonea-253301-XXXXXXf.json</code>可用来访问您的云端资源，请妥善保存。<br>
<a href="https://52mip.com/usr/uploads/2019/09/385053296.png"><img src="https://52mip.com/usr/uploads/2019/09/385053296.png" alt="iam_admin_serviceaccounts6.png"></a></p>
<p>打开刚才创建下载的文件<code>folderclonea-253301-XXXXXXf.json</code>找到<code>client_email</code>把里面生成的邮箱记下来<br>
<a href="https://52mip.com/usr/uploads/2019/09/2240831046.png"><img src="https://52mip.com/usr/uploads/2019/09/2240831046.png" alt="folderclone_client_email.png"></a></p>
<p>比如我的是【<strong><code>folderclone@folderclonea-253301.iam.gserviceaccount.com</code></strong>】</p>
<h2 id="新建项目foldercloneb">新建项目foldercloneB</h2>
<p>在<code>Google</code><a href="https://console.developers.google.com/">云端控制台</a>【<strong>创建项目</strong>】【<strong><code>foldercloneB</code></strong>】【<strong>选择项目</strong>】并切换到项目<code>foldercloneB</code></p>
<p>添加<code>API</code>【<strong><code>Google Drive API</code></strong>】和【<strong><code>Identity and Access Management (IAM) API</code></strong>】并启用它们。方法跟新建项目<code>foldercloneA</code>一样</p>
<p>【<strong>导航菜单</strong>】【<strong><code>IAM</code>和管理</strong>】【<strong><code>IAM</code></strong>】【<strong>添加</strong>】项目<code>foldercloneA</code>文件<code>folderclonea-253301-XXXXXXf.json</code>里的邮箱地址<br>
<a href="https://52mip.com/usr/uploads/2019/09/1624358953.png"><img src="https://52mip.com/usr/uploads/2019/09/1624358953.png" alt="foldercloneB_add_iam_admin.png"></a><br>
<a href="https://52mip.com/usr/uploads/2019/09/3818985999.png"><img src="https://52mip.com/usr/uploads/2019/09/3818985999.png" alt="foldercloneB_add_iam_admin1.png"></a><br>
<a href="https://52mip.com/usr/uploads/2019/09/3986138146.png"><img src="https://52mip.com/usr/uploads/2019/09/3986138146.png" alt="foldercloneB_add_iam_admin2.png"></a></p>
<p>并记录保存好<code>foldercloneB_ID</code><br>
<a href="https://52mip.com/usr/uploads/2019/09/3992917527.png"><img src="https://52mip.com/usr/uploads/2019/09/3992917527.png" alt="foldercloneB_ID.png"></a></p>
<p>比如这里的是<code>foldercloneb-253302</code></p>
<h2 id="安装python并配置依赖环境">安装Python并配置依赖环境</h2>
<p>使用<code>64-bit</code>的<code>Windows</code></p>
<h3 id="下载python并安装">下载Python并安装</h3>
<p><a href="https://www.python.org/ftp/python/3.7.4/python-3.7.4-amd64.exe">下载Python 3.7.4 64-bit</a>， 并按如下图所示安装<br>
<a href="https://52mip.com/usr/uploads/2019/09/4118890716.png"><img src="https://52mip.com/usr/uploads/2019/09/4118890716.png" alt="install_python1.png"></a><br>
<a href="https://52mip.com/usr/uploads/2019/09/186223995.png"><img src="https://52mip.com/usr/uploads/2019/09/186223995.png" alt="install_python2.png"></a><br>
<a href="https://52mip.com/usr/uploads/2019/09/4045478632.png"><img src="https://52mip.com/usr/uploads/2019/09/4045478632.png" alt="install_python3.png"></a></p>
<h3 id="安装依赖环境">安装依赖环境</h3>
<p>在<code>C:\Program Files\Python37</code>目录中按【<strong><code>Shift</code>+鼠标右键</strong>】，或者在<code>C:\Program Files\Python37</code>目录地址栏中输入“<code>CMD</code>”，然后点击回车键：<br>
<a href="https://52mip.com/usr/uploads/2019/09/2438276197.png"><img src="https://52mip.com/usr/uploads/2019/09/2438276197.png" alt="Python99.png"></a></p>
<p>打开<code>CMD</code>安装以下依赖环境</p>
<pre><code>python -m pip install --upgrade pip
pip install oauth2client
pip install google-api-python-client
pip install progress
pip install progressbar2
pip install  httplib2shim
</code></pre>
<h2 id="设置folderclone">设置folderclone</h2>
<p>项目地址<code>https://github.com/SameerkumarP/Multifolderclone</code></p>
<h3 id="设置folderclone文件">设置<code>folderclone</code>文件</h3>
<p>克隆<a href="https://github.com/SameerkumarP/Multifolderclone/archive/master.zip">下载</a><code>folderclone</code>到本地，解压并移动文件夹到您想要的地方。</p>
<p>在该目录下新建文件夹名为<code>CONTROLLER</code><br>
<a href="https://52mip.com/usr/uploads/2019/09/3839061081.png"><img src="https://52mip.com/usr/uploads/2019/09/3839061081.png" alt="CONTROLLER.png"></a></p>
<p>把项目<code>foldercloneA</code>文件<code>folderclonea-253301-XXXXXXf.json</code>复制到文件夹<code>CONTROLLER</code>目录下：<br>
<a href="https://52mip.com/usr/uploads/2019/09/2532663970.png"><img src="https://52mip.com/usr/uploads/2019/09/2532663970.png" alt="CONTROLLER1.png"></a></p>
<h3 id="生成并创建folderclone用户及配置文件">生成并创建<code>folderclone</code>用户及配置文件</h3>
<p>进入<code>folderclone</code>文件夹目录<br>
<a href="https://52mip.com/usr/uploads/2019/09/122986206.png"><img src="https://52mip.com/usr/uploads/2019/09/122986206.png" alt="folderclone_add_user.png"></a></p>
<p>运行以下命令</p>
<blockquote>
<p>python serviceaccountfactory.py</p>
</blockquote>
<p>然后第<code>2</code>步的时候，手动输入<code>foldercloneB_ID</code>空格加数字<code>100</code>回车，回车。</p>
<p>输入生成的自定义邮箱前缀，比如我用的是<code>users</code>。</p>
<p>比如这里的是<code>foldercloneb-253302</code> <code>100</code>：<br>
<a href="https://52mip.com/usr/uploads/2019/09/1430641121.png"><img src="https://52mip.com/usr/uploads/2019/09/1430641121.png" alt="folderclone_users_config.png"></a></p>
<p>等待完成后会生成文件夹<code>accounts</code>里面会看到<code>1</code>到<code>199</code>的用户配置文件：<br>
<a href="https://52mip.com/usr/uploads/2019/09/3705285315.png"><img src="https://52mip.com/usr/uploads/2019/09/3705285315.png" alt="accounts.png"></a><br>
<a href="https://52mip.com/usr/uploads/2019/09/2827667328.png"><img src="https://52mip.com/usr/uploads/2019/09/2827667328.png" alt="accounts1.png"></a></p>
<p>这时我们可以压缩保存整个文件夹了。</p>
<h2 id="共享云端硬盘添加成员">共享云端硬盘添加成员</h2>
<p>查看【<strong>共享云端硬盘</strong>】的<code>ID</code>：<br>
<a href="https://52mip.com/usr/uploads/2019/09/910341819.png"><img src="https://52mip.com/usr/uploads/2019/09/910341819.png" alt="team_ID.png"></a></p>
<p>进入【<strong>共享云端硬盘</strong>】添加新成员项目<code>folderclone-253301-XXXXXXf.json</code>找到<code>client_email</code>里面的邮箱为管理员：<br>
<a href="https://52mip.com/usr/uploads/2019/09/177925209.png"><img src="https://52mip.com/usr/uploads/2019/09/177925209.png" alt="team_add_admin.png"></a></p>
<p>进入<code>folderclone</code>文件夹目录：<br>
<a href="https://52mip.com/usr/uploads/2019/09/2165363132.png"><img src="https://52mip.com/usr/uploads/2019/09/2165363132.png" alt="folderclone_add_user (1).png"></a></p>
<p>执行<code>python masshare.py -d YYYYYY</code> 其中<code>YYYYYY</code>替换成【<strong>共享云端硬盘</strong>】的<code>ID</code>：</p>
<pre><code>python masshare.py -d YYYYYY
</code></pre>
<p><a href="https://52mip.com/usr/uploads/2019/09/3433358180.png"><img src="https://52mip.com/usr/uploads/2019/09/3433358180.png" alt="folderclone_add_user1.png"></a><br>
<a href="https://52mip.com/usr/uploads/2019/09/3683405700.png"><img src="https://52mip.com/usr/uploads/2019/09/3683405700.png" alt="folderclone_add_user2.png"></a></p>
<h2 id="拷贝文件到共享云端硬盘">拷贝文件到共享云端硬盘</h2>
<p>先获取共享链接，且设置成知道此链接的任何人都可以查看：</p>
<p>例如分享链接<code>https://drive.google.com/open?id=1WyhcL9GbMQbtlhrmEGVSIGAltE_G5bRA</code><br>
<a href="https://52mip.com/usr/uploads/2019/09/4204873847.png"><img src="https://52mip.com/usr/uploads/2019/09/4204873847.png" alt="sharefileID.png"></a></p>
<pre><code>id=1WyhcL9GbMQbtlhrmEGVSIGAltE_G5bRA
</code></pre>
<p>如果是别人分享的链接，先右击选择添加到我的云端硬盘：<br>
<a href="https://52mip.com/usr/uploads/2019/09/3619131553.png"><img src="https://52mip.com/usr/uploads/2019/09/3619131553.png" alt="add_my_drive.png"></a></p>
<p>查看【<strong>共享云端硬盘</strong>】的<code>ID</code>：<br>
<a href="https://52mip.com/usr/uploads/2019/09/492178085.png"><img src="https://52mip.com/usr/uploads/2019/09/492178085.png" alt="team_ID.png"></a></p>
<p>进入<code>folderclone</code>文件夹目录：<br>
<a href="https://52mip.com/usr/uploads/2019/09/207284959.png"><img src="https://52mip.com/usr/uploads/2019/09/207284959.png" alt="folderclone_add_user.png"></a></p>
<p>在<code>CMD</code>窗口执行：</p>
<pre><code>python multifolderclone.py -s 源文件ID -d TD-ID
</code></pre>
<p>例如：</p>
<pre><code>python multifolderclone.py -s 1WyhcL9GbMQbtlhrmEGVSIGAltE_G5bRA -d 0ANSyUOxsS0C7Uk9PVA
</code></pre>
<h2 id="共享云端硬盘文件转移到我的云端硬盘">【<strong>共享云端硬盘</strong>】文件转移到【<strong>我的云端硬盘</strong>】</h2>
<p>借助【<strong>共享云端硬盘</strong>】作为文件中转站，我们可以从【<strong>共享云端硬盘</strong>】把文件或文件夹移动到【<strong>我的云端硬盘</strong>】</p>
<p>注意及说明</p>
<ol>
<li><code>folderclone</code>在拷贝文件夹数目多的时候不全会丢文件，文件夹较少就不会，比如就在那么几个文件夹，哪怕每个文件夹目录下有成千上万个文件也没事。</li>
<li>运行<code>CMD</code>窗口不要太多，最好最多就俩个吧，多少会大概率丢文件。</li>
<li>速度比【<strong>Copy, URL to Google Drive</strong>】【<strong>rclone</strong>】【<strong>air explorer</strong>】等快得多，并且不占用本地带宽。</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[AriaNg + rclone 实现 Google Drive 离线下载]]></title>
        <id>https://chwl66.github.io/post/OVI5xWH9j</id>
        <link href="https://chwl66.github.io/post/OVI5xWH9j">
        </link>
        <updated>2019-11-22T01:09:31.000Z</updated>
        <content type="html"><![CDATA[<h2 id="准备环境">准备环境</h2>
<ul>
<li>一台 vps 主机，博主使用 CentOS 进行演示</li>
<li>内存 &gt;= 512MB</li>
<li>KVM 架构</li>
<li>硬盘最好 &gt;= 10G</li>
<li>一个谷歌 Drive 账号</li>
</ul>
<p>更新系统并安装必须组件，此处安装 nginx web 服务器。</p>
<pre><code>yum -y update
yum -y install epel-release
yum -y install wget git unzip gcc gcc-c++ openssl-devel nginx
</code></pre>
<p>启动 nginx 并设置开机自启</p>
<pre><code>systemctl start nginx
systemctl enable nginx.service
systemctl stop firewalld # 关闭防火墙
</code></pre>
<p>这个时候可以访问服务器的外网 IP 查看 nginx 启动成功。</p>
<h2 id="安装-ariang">安装 AriaNg</h2>
<h3 id="安装-aria2">安装 aria2</h3>
<p>Aria2 是一个命令行下运行、多协议、多来源下载工具，支持磁力链接、BT 种子、HTTP、FTP 等下载协议，当然因为它是命令行下载工具，所以我们想下载一个东西还需要去敲命令自然是不方便，于是就有一些人根据 Aria2 的 API 开发了一些在线管理面板，可以直接在网页上面添加管理任务。</p>
<hr>
<p>先安装 aria2 服务端，使用逗比大佬的脚本</p>
<pre><code>wget -N --no-check-certificate https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/aria2.sh &amp;&amp; chmod +x aria2.sh &amp;&amp; bash aria2.sh
</code></pre>
<p>运行脚本后会出现脚本操作菜单，选择并输入 <code>1</code> 就会开始安装。</p>
<pre><code>Aria2 一键安装管理脚本 [vx.x.x]
-- Toyo | doub.io/shell-jc4 --
 
 1. 升级脚本
————————————
 1. 安装 Aria2
 2. 更新 Aria2
 3. 卸载 Aria2
————————————
 4. 启动 Aria2
 5. 停止 Aria2
 6. 重启 Aria2
————————————
 7. 修改 配置文件
 8. 查看 配置信息
 9. 查看 日志信息
10. 配置 自动更新 BT-Tracker服务器
————————————
 
当前状态: 已安装 并 已启动
 
请输入数字 [0-10]:
</code></pre>
<p>安装成功后配置文件在 <code>/root/.aria2/aria2.conf</code>，几个比较重要的配置：</p>
<pre><code># aria2 下载文件后所在目录
dir=/usr/local/caddy/www/aria2/Download
# aria2 RPC 监听端口
rpc-listen-port=6800
# aria2 RPC 秘钥
rpc-secret=codesofun
# 下载成功后执行的脚本
on-download-complete=/root/rcloneupload.sh
</code></pre>
<p>将下载目录修改为 <code>/data/Download</code></p>
<p>创建目录</p>
<pre><code>mkdir -p /data/Download
</code></pre>
<p>运行脚本</p>
<pre><code>bash aria2.sh
</code></pre>
<p>运行脚本后会出现脚本操作菜单，选择并输入 <code>7</code> 就会按照选项进行修改。</p>
<pre><code>Aria2 一键安装管理脚本 [vx.x.x]
-- Toyo | doub.io/shell-jc4 --
 
 0. 升级脚本
————————————
 1. 安装 Aria2
 2. 更新 Aria2
 3. 卸载 Aria2
————————————
 4. 启动 Aria2
 5. 停止 Aria2
 6. 重启 Aria2
————————————
 7. 修改 配置文件
 8. 查看 配置信息
 9. 查看 日志信息
10. 配置 自动更新 BT-Tracker服务器
————————————
 
当前状态: 已安装 并 已启动
 
请输入数字 [0-10]:
</code></pre>
<p><strong>其他操作</strong></p>
<ul>
<li>启动：<code>/etc/init.d/aria2 start</code></li>
<li>停止：<code>/etc/init.d/aria2 stop</code></li>
<li>重启：<code>/etc/init.d/aria2 restart</code></li>
<li>查看状态：<code>/etc/init.d/aria2 status</code></li>
<li>配置文件：<code>/root/.aria2/aria2.conf</code> （配置文件包含中文注释，但是一些系统可能不支持显示中文）</li>
<li>令牌密匙：随机生成（可以自己修改配置文件）</li>
<li>下载目录：<code>/data/Download</code></li>
</ul>
<h2 id="安装-ariang-2">安装 AriaNg</h2>
<p>AriaNg 是一个前端(HTML+JS静态)控制面板，不需要和 Aria2 (后端/服务端)放在一个服务器或者设备中，你甚至可以只在服务器上面搭建 Aria2 后端，然后访问别人建好的 AriaNg 前端面板，也可以远程操作 Aria2 后端！</p>
<p>Github 源码地址：https://github.com/mayswind/AriaNg</p>
<p>不需要和 Aria2 (后端/服务端)放在一个服务器或者设备中，你甚至可以只在服务器上面搭建 Aria2 后端，然后访问别人建好的 AriaNg 前端面板，也可以远程操作 Aria2 后端！</p>
<p><strong>下载 AriaNg</strong></p>
<pre><code>mkdir -p /data/www/ariang
cd /data/www/ariang
wget https://github.com/mayswind/AriaNg-DailyBuild/archive/master.zip &amp;&amp; unzip master.zip
mv AriaNg-DailyBuild-master/* .
rm -rf master.zip AriaNg-DailyBuild-master
</code></pre>
<p><strong>配置 Nginx 虚拟主机</strong></p>
<pre><code>cd /etc/nginx/conf.d
touch ariang.conf
</code></pre>
<p>编辑配置</p>
<pre><code>vim ariang.conf
</code></pre>
<p>编辑nginx 配置，将下面的代码填入进去。</p>
<pre><code>server {
    listen 80;
    server_name &lt;IP_ADDRESS&gt;;

    location / {
        root   /data/www/ariang;
        index  index.html index.htm;
    }
}
</code></pre>
<blockquote>
<p>这个时候也可以使用 <code>nginx -t</code> 测试一下配置文件是否修改正确</p>
</blockquote>
<p>重新加载 nginx 配置</p>
<pre><code>systemctl reload nginx
</code></pre>
<p>访问 <code>http://IP_HOST</code> 即可看到 ariaNg 效果。</p>
<figure data-type="image" tabindex="1"><img src="https://blog.codesofun.com/assets/images/2018/11/ariang.png" alt="img"></figure>
<h1 id="配置-google-drive">配置 Google Drive</h1>
<h2 id="挂载-google-drive-到-vps">挂载 Google Drive 到 VPS</h2>
<p>安装 Rclone</p>
<pre><code>yum -y install unzip
curl https://rclone.org/install.sh | sudo bash
</code></pre>
<p>配置</p>
<pre><code>[root@vultr ~]# rclone config
2018/11/25 09:31:54 NOTICE: Config file &quot;/root/.config/rclone/rclone.conf&quot; not found - using defaults
No remotes found - make a new one
n) New remote
s) Set configuration password
q) Quit config
n/s/q&gt; n
name&gt; codesofun
Type of storage to configure.
Enter a string value. Press Enter for the default (&quot;&quot;).
Choose a number from below, or type in your own value
 1 / A stackable unification remote, which can appear to merge the contents of several remotes
   \ &quot;union&quot;
 2 / Alias for a existing remote
   \ &quot;alias&quot;
 3 / Amazon Drive
   \ &quot;amazon cloud drive&quot;
 4 / Amazon S3 Compliant Storage Providers (AWS, Ceph, Dreamhost, IBM COS, Minio)
   \ &quot;s3&quot;
 5 / Backblaze B2
   \ &quot;b2&quot;
 6 / Box
   \ &quot;box&quot;
 7 / Cache a remote
   \ &quot;cache&quot;
 8 / Dropbox
   \ &quot;dropbox&quot;
 9 / Encrypt/Decrypt a remote
   \ &quot;crypt&quot;
10 / FTP Connection
   \ &quot;ftp&quot;
11 / Google Cloud Storage (this is not Google Drive)
   \ &quot;google cloud storage&quot;
12 / Google Drive
   \ &quot;drive&quot;
13 / Hubic
   \ &quot;hubic&quot;
14 / JottaCloud
   \ &quot;jottacloud&quot;
15 / Local Disk
   \ &quot;local&quot;
16 / Mega
   \ &quot;mega&quot;
17 / Microsoft Azure Blob Storage
   \ &quot;azureblob&quot;
18 / Microsoft OneDrive
   \ &quot;onedrive&quot;
19 / OpenDrive
   \ &quot;opendrive&quot;
20 / Openstack Swift (Rackspace Cloud Files, Memset Memstore, OVH)
   \ &quot;swift&quot;
21 / Pcloud
   \ &quot;pcloud&quot;
22 / QingCloud Object Storage
   \ &quot;qingstor&quot;
23 / SSH/SFTP Connection
   \ &quot;sftp&quot;
24 / Webdav
   \ &quot;webdav&quot;
25 / Yandex Disk
   \ &quot;yandex&quot;
26 / http Connection
   \ &quot;http&quot;
Storage&gt; 12
** See help for drive backend at: https://rclone.org/drive/ **

Google Application Client Id
Leave blank normally.
Enter a string value. Press Enter for the default (&quot;&quot;).
client_id&gt;
Google Application Client Secret
Leave blank normally.
Enter a string value. Press Enter for the default (&quot;&quot;).
client_secret&gt;
Scope that rclone should use when requesting access from drive.
Enter a string value. Press Enter for the default (&quot;&quot;).
Choose a number from below, or type in your own value
 1 / Full access all files, excluding Application Data Folder.
   \ &quot;drive&quot;
 2 / Read-only access to file metadata and file contents.
   \ &quot;drive.readonly&quot;
   / Access to files created by rclone only.
 3 | These are visible in the drive website.
   | File authorization is revoked when the user deauthorizes the app.
   \ &quot;drive.file&quot;
   / Allows read and write access to the Application Data folder.
 4 | This is not visible in the drive website.
   \ &quot;drive.appfolder&quot;
   / Allows read-only access to file metadata but
 5 | does not allow any access to read or download file content.
   \ &quot;drive.metadata.readonly&quot;
scope&gt; 1
ID of the root folder
Leave blank normally.
Fill in to access &quot;Computers&quot; folders. (see docs).
Enter a string value. Press Enter for the default (&quot;&quot;).
root_folder_id&gt;
Service Account Credentials JSON file path
Leave blank normally.
Needed only if you want use SA instead of interactive login.
Enter a string value. Press Enter for the default (&quot;&quot;).
service_account_file&gt;
Edit advanced config? (y/n)
y) Yes
n) No
y/n&gt; n
Remote config
Use auto config?
 * Say Y if not sure
 * Say N if you are working on a remote or headless machine or Y didn't work
y) Yes
n) No
y/n&gt; n
If your browser doesn't open automatically go to the following link: https://accounts.google.com/o/oauth2/auth?access_type=offline&amp;client_id=202264815644.apps.googleusercontent.com&amp;redirect_uri=urn%3Aietf%3Awg%3Aoauth%3A2.0%3Aoob&amp;response_type=code&amp;scope=https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fdrive&amp;state=0fbdd**********************05a3b00e23
Log in and authorize rclone for access
Enter verification code&gt; 4/owSACseTxM*************c2HtEVX_yEhBcr--JiFTA7-Pfg

Configure this as a team drive?
y) Yes
n) No
y/n&gt; y
Fetching team drive list...
No team drives found in your account--------------------
[codesofun]
type = drive
scope = drive
token = {&quot;access_token&quot;:&quot;ya29.GltfBn_YA8e0lgJNKeMAHZ3b_IeIBXHHrJxMO7wfW0AsY6v_Nso8YczhZafVe8UIIgK6ft1dn6BqP-UWp-W2YXBtcf6zbLuIZgKcPqwnhsVAkx3f7QcO5m0EUvAv&quot;,&quot;token_type&quot;:&quot;Bearer&quot;,&quot;refresh_token&quot;:&quot;1/hFSVnEeJ8CkFmrpdd7IGNx69mhkj8Cpny6JUktv3xcY&quot;,&quot;expiry&quot;:&quot;2018-11-25T10:42:09.400295503Z&quot;}
--------------------
y) Yes this is OK
e) Edit this remote
d) Delete this remote
y/e/d&gt; y
Current remotes:

Name                 Type
====                 ====
codesofun            drive

e) Edit existing remote
n) New remote
d) Delete remote
r) Rename remote
c) Copy remote
s) Set configuration password
q) Quit config
e/n/d/r/c/s/q&gt; q
</code></pre>
<h1 id="整合-aria2-rclone">整合 Aria2 + Rclone</h1>
<p>这个时候我们使用 aria2 去下载文件，下载成功后触发一个脚本让它将文件移动到 Rclone 同步的文件夹内，这样在 Google Drive 就会自动有这个文件啦。</p>
<p>新建一个名为 <code>rcloneupload.sh</code> 的脚本。</p>
<pre><code>vim /root/rcloneupload.sh
</code></pre>
<p>编辑脚本，将下面内容全部填入脚本中保存。</p>
<pre><code>#!/bin/bash

filepath=$3	 #取文件原始路径，如果是单文件则为/Download/a.mp4，如果是文件夹则该值为文件夹内第一个文件比如/Download/a/1.mp4
path=${3%/*}	 #取文件根路径，如把/Download/a/1.mp4变成/Download/a
downloadpath='/data/Download'	#Aria2下载目录
name='codesofun' #配置Rclone时的name
folder='/share'	 #网盘里的文件夹，如果是根目录直接留空
MinSize='10k'	 #限制最低上传大小，默认10k，BT下载时可防止上传其他无用文件。会删除文件，谨慎设置。
MaxSize='15G'	 #限制最高文件大小，默认15G，OneDrive上传限制。

if [ $2 -eq 0 ]; then exit 0; fi

while true; do
if [ &quot;$path&quot; = &quot;$downloadpath&quot; ] &amp;&amp; [ $2 -eq 1 ]	#如果下载的是单个文件
    then
    rclone move -v &quot;$filepath&quot; ${name}:${folder} --min-size $MinSize --max-size $MaxSize
    rm -vf &quot;$filepath&quot;.aria2	#删除残留的.aria.2文件
    exit 0
elif [ &quot;$path&quot; != &quot;$downloadpath&quot; ]	#如果下载的是文件夹
    then
    while [[ &quot;`ls -A &quot;$path/&quot;`&quot; != &quot;&quot; ]]; do
    rclone move -v &quot;$path&quot; ${name}:/${folder}/&quot;${path##*/}&quot; --min-size $MinSize --max-size $MaxSize --delete-empty-src-dirs
    rclone delete -v &quot;$path&quot; --max-size $MinSize	#删除多余的文件
    rclone rmdirs -v &quot;$downloadpath&quot; --leave-root	#删除空目录，--delete-empty-src-dirs 参数已实现，加上无所谓。
    done
    rm -vf &quot;$path&quot;.aria2	#删除残留的.aria2文件
    exit 0
fi
done
</code></pre>
<p>需要修改几个地方：</p>
<ul>
<li><code>downloadpath</code>：填写 aria2 的下载目录</li>
<li><code>name</code>：填写 rclone 配置的名称</li>
<li><code>folder</code>：填写谷歌云盘的文件夹名称，根目录填 <code>/</code> 即可</li>
</ul>
<p>保存后给予执行权限</p>
<pre><code>chmod +x /root/rcloneupload.sh
</code></pre>
<p>然后再到 Aria2 配置文件中加上一行 <code>on-download-complete=/root/rcloneupload.sh</code> 即可，后面为脚本的路径。重启 Aria2 生效。</p>
<pre><code>vim /root/.aria2/aria2.conf

on-download-complete=/root/rcloneupload.sh
/etc/init.d/aria2 restart
</code></pre>
<h1 id="请开始你的表演">请开始你的表演</h1>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[GoIndex部署教程，用Google Drive来做目录索引网盘]]></title>
        <id>https://chwl66.github.io/post/sRQUu33vw</id>
        <link href="https://chwl66.github.io/post/sRQUu33vw">
        </link>
        <updated>2019-11-22T01:08:54.000Z</updated>
        <content type="html"><![CDATA[<p>感谢大佬@<a href="https://www.hostloc.com/space-uid-18200.html">donwa</a>又更新了一个针对Google Drive的文件目录代码！这里更新一篇文章介绍一下！！</p>
<p>由于博主最近在疯狂加班，时间太紧张了，文章内容均来热情的网友！最后的【参考文献】一一列出！</p>
<p>之前本博客更新过大佬的另一个开源代码！<a href="https://51.ruyo.net/9946.html">OneIndex部署教程，利用OneDrive打造专属分享型网盘</a></p>
<h2 id="功能介绍">功能介绍</h2>
<p>部署在 CloudFlare Workers的小程序。<br>
可以将 Google Drive 文件以目录形式列出，并直连下载。<br>
流量走 CloudFlare ，网速由 CloudFlare 决定。</p>
<h2 id="开源地址">开源地址</h2>
<p>https://github.com/donwa/goindex</p>
<h2 id="演示地址">演示地址</h2>
<p><a href="https://index.gd.workers.dev/">https://index.gd.workers.dev/</a></p>
<h2 id="功能特点">功能特点</h2>
<p>1、免费。<br>
2、直链。<br>
3、免番。</p>
<h2 id="使用限制">使用限制</h2>
<p>wokers一天10万请求限制<br>
google drive 下载10T/24h（大佬说的）<br>
google api 调用限制</p>
<h2 id="部署步骤">部署步骤</h2>
<p>1）访问 https://install.gd.workers.dev/ 点击 【1.获取认证码】登陆Google帐号，会有code(画线部分）。将上面的CODE复制到 Auth认证码部分。目录ID可以留空！</p>
<figure data-type="image" tabindex="1"><img src="https://yanxuan.nosdn.127.net/f044b5331e6022c2f25e88635e056b5a.jpg" alt="img"></figure>
<p>2）点【2.生成代码】，复制生成的代码，打开 https://dash.cloudflare.com/ 登陆帐号，选个域名，点击 Workers，如图</p>
<figure data-type="image" tabindex="2"><img src="https://yanxuan.nosdn.127.net/1c502a8a7e1da3df69f4861e72596f60.png" alt="img"></figure>
<p>3）点击 new Workers dashboard ，如图，需要起个名字，我已经起过了，就没有截图了，类似与  qwe.workers.dev的名字，只能修改前缀，后缀workers.dev 固定的。</p>
<figure data-type="image" tabindex="3"><img src="https://yanxuan.nosdn.127.net/67c48700ec92a5696530070c57cc6a09.png" alt="img"></figure>
<p>4）点击Create a Workers，如图，</p>
<figure data-type="image" tabindex="4"><img src="https://yanxuan.nosdn.127.net/b78670ed2eb6ba0dd8d7adee51282767.png" alt="img"></figure>
<p>5）在Script里复制刚才的代码code，右下角Run可以在右边看到浏览状态，右边上方有地址，左边上方可以修改地址，例如修改为121，Save and Deploy保存</p>
<p>121.qwe.workers.dev 就是你的地址了。</p>
<h2 id="其他内容">其他内容</h2>
<p><strong>如何自定义域名</strong></p>
<p>1）先让需要绑定的域名通过cf，指向ip随意。</p>
<figure data-type="image" tabindex="5"><img src="https://yanxuan.nosdn.127.net/9d2b1828e80c5eab9fa46b4f92319117.png" alt="img"></figure>
<p>2）添加Route</p>
<figure data-type="image" tabindex="6"><img src="https://yanxuan.nosdn.127.net/4b0dffe93e199c469282bfb3d0b837ec.png" alt="img"></figure>
<figure data-type="image" tabindex="7"><img src="https://yanxuan.nosdn.127.net/b6fe3d4fd9ae7eb47bfb5faa6c4a2c84.png" alt="img"></figure>
<p><strong>关于目录ID</strong><br>
打开团队盘(或文件夹或别人共享的文件夹)，看地址栏。<br>
https://drive.google.com/drive/folders/{这后面一堆代码就是id}<br>
留空是根目录。</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[PyOne一键安装脚本 for CentOS 7/Debian 8+/Ubuntu 16+]]></title>
        <id>https://chwl66.github.io/post/28IUd1HzY</id>
        <link href="https://chwl66.github.io/post/28IUd1HzY">
        </link>
        <updated>2019-11-22T01:07:27.000Z</updated>
        <content type="html"><![CDATA[<p><strong>说明：</strong><code>PyOne</code>最近凭着离线下载(完成并自动上传至<code>Onedrive</code>)和绑定多网盘的功能被越来越多的人使用，如果你还不知道<code>PyOne</code>是何物的可以查看该教程→<a href="https://www.moerats.com/archives/734/">点击查看</a>。作者更新也勤奋，所以得支持一下，之前博主发过基于宝塔的手动安装教程和<code>Docker</code>安装教程，查看：<a href="https://www.moerats.com/archives/734/">手动安装</a>、<a href="https://www.moerats.com/archives/799/">Docker安装</a>。不过由于宝塔的<code>Mongodb</code>很容易出错，有些小白也不会解决，而<code>Docker</code>也不支持<code>OpenVZ</code>，所以博主写了个一键脚本，这里分享下。</p>
<h2 id="脚本说明">脚本说明</h2>
<pre><code>#脚本会一键安装PyOne所需要的Mongodb、Redis、Aria2等环境，域名使用Caddy反代，自动配置SSL证书。

#本脚本使用的Aria2为某大佬编译的多线程版本，其特点可以将下载速度最大化优化，博主已配置完毕，如服务器性能不足，可将线程自行调整。
方法：修改配置文件/root/.aria2/aria2.conf，线程参数split=64，请自行调整。

#Aria2已添加了BT-Trackers服务器，并定时自动更新服务器地址。

#脚本使用systemctl替换了程序所使用的supervisord进程守护，所以程序的重启等命令会和官方文档上的不一样，详细的使用命令可以看文章后面。

#选择域名访问的，需要提前让解析生效，不然脚本会自动断开，因为后面需要签发SSL证书，ip必须为服务器ip。
</code></pre>
<h2 id="更新">更新</h2>
<pre><code>【2019.9.28】
新增Debian 10，升级MongoDB版本到4.0，有问题可以留言。
【2019.6.27】
修复部分CentOS 7安装出错的问题，并新增Ubuntu系统，已在Vultr的Ubuntu 16.04、18.04、18.10、19.04上测试通过
【2019.2.23】
鉴于有人需要3.0版本，现已增加安装3.0版本选项，多个选择，并使用的3.0最后一个版本。
【2019.2.16】
修改脚本部分安装步骤，使其支持PyOne4.0
【2019.1.31】
修复部分系统安装启动pyone失败的问题
【2018.11.30】
修复PyOne刷新不出文件夹/文件的问题。
</code></pre>
<h2 id="安装">安装</h2>
<p><strong>系统要求：</strong><code>CentOS 7</code>、<code>Debian 8+</code>、<code>Ubuntu 16+</code>，建议<code>Debian 9</code>，且为刚安装好的系统，尽量不要用精简版系统。</p>
<p>使用命令：</p>
<pre><code>wget -N --no-check-certificate https://www.moerats.com/usr/shell/PyOne/PyOne.sh
bash PyOne.sh
</code></pre>
<p>根据需求选择是否使用域名访问，然后输入域名和<code>Aria2</code>密匙即可。<br>
<a href="https://www.moerats.com/usr/picture/PyOne_shell.png"><img src="https://www.moerats.com/usr/picture/PyOne_shell.png" alt="请输入图片描述"></a></p>
<p>安装完成后，如果打不开网站的，可以使用命令一起查看下各程序状态。</p>
<pre><code>#使用域名访问的
systemctl status aria2 mongod redis-server pyone caddy
#使用IP访问的
systemctl status aria2 mongod redis-server pyone
</code></pre>
<p>如果有显示<code>Active:inactive</code>的，可以留言说下具体程序和系统。反之如果都为<code>running</code>，可以检查下防火墙端口，比如阿里云，谷歌云等，还需要在服务器管理面板上开放<code>34567</code>端口才行。</p>
<h2 id="相关命令">相关命令</h2>
<pre><code>#以下程序均已配置开机自启，所以就不说开机自启命令了。

#Redis使用命令
启动：systemctl start redis-server
重启：systemctl restart redis-server
停止：systemctl stop redis-server
状态：systemctl status redis-server

#Mongodb使用命令
启动：systemctl start mongod
重启：systemctl restart mongod
停止：systemctl stop mongod
状态：systemctl status mongod

#Aria2使用命令
启动：systemctl start aria2
重启：systemctl restart aria2
停止：systemctl stop aria2
状态：systemctl status aria2

#Caddy使用命令(使用域名的才会安装Caddy)
启动：systemctl start caddy
重启：systemctl restart caddy
停止：systemctl stop caddy
状态：systemctl status caddy

#PyOne使用命令
启动：systemctl start pyone
重启：systemctl restart pyone
停止：systemctl stop pyone
状态：systemctl status pyone
</code></pre>
<h2 id="相关目录">相关目录</h2>
<pre><code>PyOne程序目录：/root/PyOne
Caddy配置文件目录：/root/.caddy
Aria2配置文件目录：/root/.aria2
</code></pre>
<h2 id="相关说明">相关说明</h2>
<pre><code>#关于操作说明
由于更换了原程序进程守护，所以网站右上角的重启网站按钮已失效，请在SSH客户端使用systemctl restart pyone命令重启程序。

#关于离线下载
Aria2配置文件的下载路径为/root/Download，但该程序自带的离线下载不调用配置文件，所以使用本程序离线下载的目录为/root/PyOne/upload。

由于本程序离线下载不调用配置文件，所以Aria2多线程可能会发挥不出来，BT服务器也无效，不过会玩的，可以通过修改根目录的aria2.py文件某些参数达到目的，或者直接研究该教程：https://www.moerats.com/archives/697/，使用Aria2面板来离线下载更好，毕竟后者用的脚本比自带离线下载更稳定。

#刷新缓存问题
如果你在后台执行缓存刷新操作，可能短时间不会生效，建议直接在SSH客户端使用python /root/PyOne/function.py UpdateFile命令刷新
</code></pre>
<p>最后更多的使用方法(包括程序更新)可以查看该教程→<a href="https://www.moerats.com/archives/734/">点击查看</a>，除了<code>PyOne</code>启动命令不一样以外，其它都一样，包括上传等命令。</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[利用CloudFlare Worker 免费部署 JSProxy 服务]]></title>
        <id>https://chwl66.github.io/post/pLeXJDL_N</id>
        <link href="https://chwl66.github.io/post/pLeXJDL_N">
        </link>
        <updated>2019-11-22T01:06:45.000Z</updated>
        <content type="html"><![CDATA[<p>JSProxy 一个基于浏览器端 JS 实现的在线代理，这里不多介绍！</p>
<p>本文主要介绍一下利用<code>CloudFlare Worker</code> 来搭建一个JSProxy服务。</p>
<p><code>CloudFlare Worker</code> 是 CloudFlare 的边缘计算服务。开发者可通过 JavaScript 对 CDN 进行编程，从而能灵活处理 HTTP 请求。这使得很多任务可在 CDN 上完成，无需自己的服务器参与。</p>
<p>CFW免费服务，支持每天10 万次免费请求！基本也够用了！</p>
<h2 id="项目介绍">项目介绍</h2>
<p>项目地址：<a href="https://github.com/EtherDream/jsproxy">https://github.com/EtherDream/jsproxy</a></p>
<h2 id="准备工作">准备工作</h2>
<p>Cloudflare 账号一个</p>
<h2 id="使用教程">使用教程</h2>
<p>1）打开 <a href="https://workers.cloudflare.com">https://workers.cloudflare.com</a>，登陆上你的 Cloudflare 账号激活 Workers 服务</p>
<figure data-type="image" tabindex="1"><img src="https://ae04.alicdn.com/kf/HTB1BwEMaET1gK0jSZFr763NCXXaY.png" alt="img"></figure>
<p>然后创建一个 Workers【Create a Worker】</p>
<figure data-type="image" tabindex="2"><img src="https://ae02.alicdn.com/kf/HTB16NsHaEY1gK0jSZFM761WcVXat.png" alt="img"></figure>
<p>2）修改一下子域名，创建出来的域名格式 自定义的内容.Cloudflare用户名.workers.dev</p>
<figure data-type="image" tabindex="3"><img src="https://ae06.alicdn.com/kf/HTB10hkMaxz1gK0jSZSg761vwpXaj.png" alt="img"></figure>
<p>3）复制<a href="https://raw.githubusercontent.com/EtherDream/jsproxy/master/cf-worker/index.js"> https://raw.githubusercontent.com/EtherDream/jsproxy/master/cf-worker/index.js</a> 的内容到左侧代码（Script）区域</p>
<p>文章最下方有代码备份！！</p>
<figure data-type="image" tabindex="4"><img src="https://ae03.alicdn.com/kf/HTB1EA.LaAL0gK0jSZFA763A9pXas.png" alt="img"></figure>
<p>4）先点击【Run】右侧看执行效果，再点击 【Save and deploy】 部署代码</p>
<p>5）届时你可以访问你的站点https://xxx.子域名.workers.dev查看效果</p>
<p>进入站点后将线路选择切换为当前站点即可使用</p>
<p>特别提示：浏览网站的时候，有时候会提示加载不安全脚本，点击允许即可！</p>
<h2 id="代码备份">代码备份</h2>
<pre><code>'use strict'

/**
 * static files (404.html, sw.js, conf.js)
 */
const ASSET_URL = 'https://etherdream.github.io/jsproxy'

const JS_VER = 10
const MAX_RETRY = 1

/** @type {RequestInit} */
const PREFLIGHT_INIT = {
  status: 204,
  headers: new Headers({
    'access-control-allow-origin': '*',
    'access-control-allow-methods': 'GET,POST,PUT,PATCH,TRACE,DELETE,HEAD,OPTIONS',
    'access-control-max-age': '1728000',
  }),
}

/**
 * @param {any} body
 * @param {number} status
 * @param {Object&lt;string, string&gt;} headers
 */
function makeRes(body, status = 200, headers = {}) {
  headers['--ver'] = JS_VER
  headers['access-control-allow-origin'] = '*'
  return new Response(body, {status, headers})
}


/**
 * @param {string} urlStr 
 */
function newUrl(urlStr) {
  try {
    return new URL(urlStr)
  } catch (err) {
    return null
  }
}


addEventListener('fetch', e =&gt; {
  const ret = fetchHandler(e)
    .catch(err =&gt; makeRes('cfworker error:\n' + err.stack, 502))
  e.respondWith(ret)
})


/**
 * @param {FetchEvent} e 
 */
async function fetchHandler(e) {
  const req = e.request
  const urlStr = req.url
  const urlObj = new URL(urlStr)
  const path = urlObj.href.substr(urlObj.origin.length)

  if (urlObj.protocol === 'http:') {
    urlObj.protocol = 'https:'
    return makeRes('', 301, {
      'strict-transport-security': 'max-age=99999999; includeSubDomains; preload',
      'location': urlObj.href,
    })
  }

  if (path.startsWith('/http/')) {
    return httpHandler(req, path.substr(6))
  }

  switch (path) {
  case '/http':
    return makeRes('请更新 cfworker 到最新版本!')
  case '/ws':
    return makeRes('not support', 400)
  case '/works':
    return makeRes('it works')
  default:
    // static files
    return fetch(ASSET_URL + path)
  }
}


/**
 * @param {Request} req
 * @param {string} pathname
 */
function httpHandler(req, pathname) {
  const reqHdrRaw = req.headers
  if (reqHdrRaw.has('x-jsproxy')) {
    return Response.error()
  }

  // preflight
  if (req.method === 'OPTIONS' &amp;&amp;
      reqHdrRaw.has('access-control-request-headers')
  ) {
    return new Response(null, PREFLIGHT_INIT)
  }

  let acehOld = false
  let rawSvr = ''
  let rawLen = ''
  let rawEtag = ''

  const reqHdrNew = new Headers(reqHdrRaw)
  reqHdrNew.set('x-jsproxy', '1')

  // 此处逻辑和 http-dec-req-hdr.lua 大致相同
  // https://github.com/EtherDream/jsproxy/blob/master/lua/http-dec-req-hdr.lua
  const refer = reqHdrNew.get('referer')
  const query = refer.substr(refer.indexOf('?') + 1)
  if (!query) {
    return makeRes('missing params', 403)
  }
  const param = new URLSearchParams(query)

  for (const [k, v] of Object.entries(param)) {
    if (k.substr(0, 2) === '--') {
      // 系统信息
      switch (k.substr(2)) {
      case 'aceh':
        acehOld = true
        break
      case 'raw-info':
        [rawSvr, rawLen, rawEtag] = v.split('|')
        break
      }
    } else {
      // 还原 HTTP 请求头
      if (v) {
        reqHdrNew.set(k, v)
      } else {
        reqHdrNew.delete(k)
      }
    }
  }
  if (!param.has('referer')) {
    reqHdrNew.delete('referer')
  }

  // cfworker 会把路径中的 `//` 合并成 `/`
  const urlStr = pathname.replace(/^(https?):\/+/, '$1://')
  const urlObj = newUrl(urlStr)
  if (!urlObj) {
    return makeRes('invalid proxy url: ' + urlStr, 403)
  }

  /** @type {RequestInit} */
  const reqInit = {
    method: req.method,
    headers: reqHdrNew,
    redirect: 'manual',
  }
  if (req.method === 'POST') {
    reqInit.body = req.body
  }
  return proxy(urlObj, reqInit, acehOld, rawLen, 0)
}


/**
 * 
 * @param {URL} urlObj 
 * @param {RequestInit} reqInit 
 * @param {number} retryTimes 
 */
async function proxy(urlObj, reqInit, acehOld, rawLen, retryTimes) {
  const res = await fetch(urlObj.href, reqInit)
  const resHdrOld = res.headers
  const resHdrNew = new Headers(resHdrOld)

  let expose = '*'
  
  for (const [k, v] of resHdrOld.entries()) {
    if (k === 'access-control-allow-origin' ||
        k === 'access-control-expose-headers' ||
        k === 'location' ||
        k === 'set-cookie'
    ) {
      const x = '--' + k
      resHdrNew.set(x, v)
      if (acehOld) {
        expose = expose + ',' + x
      }
      resHdrNew.delete(k)
    }
    else if (acehOld &amp;&amp;
      k !== 'cache-control' &amp;&amp;
      k !== 'content-language' &amp;&amp;
      k !== 'content-type' &amp;&amp;
      k !== 'expires' &amp;&amp;
      k !== 'last-modified' &amp;&amp;
      k !== 'pragma'
    ) {
      expose = expose + ',' + k
    }
  }

  if (acehOld) {
    expose = expose + ',--s'
    resHdrNew.set('--t', '1')
  }

  // verify
  if (rawLen) {
    const newLen = resHdrOld.get('content-length') || ''
    const badLen = (rawLen !== newLen)

    if (badLen) {
      if (retryTimes &lt; MAX_RETRY) {
        urlObj = await parseYtVideoRedir(urlObj, newLen, res)
        if (urlObj) {
          return proxy(urlObj, reqInit, acehOld, rawLen, retryTimes + 1)
        }
      }
      return makeRes(res.body, 400, {
        '--error': `bad len: ${newLen}, except: ${rawLen}`,
        'access-control-expose-headers': '--error',
      })
    }

    if (retryTimes &gt; 1) {
      resHdrNew.set('--retry', retryTimes)
    }
  }

  let status = res.status

  resHdrNew.set('access-control-expose-headers', expose)
  resHdrNew.set('access-control-allow-origin', '*')
  resHdrNew.set('--s', status)
  resHdrNew.set('--ver', JS_VER)

  resHdrNew.delete('content-security-policy')
  resHdrNew.delete('content-security-policy-report-only')
  resHdrNew.delete('clear-site-data')

  if (status === 301 ||
      status === 302 ||
      status === 303 ||
      status === 307 ||
      status === 308
  ) {
    status = status + 10
  }

  return new Response(res.body, {
    status,
    headers: resHdrNew,
  })
}


/**
 * @param {URL} urlObj 
 */
function isYtUrl(urlObj) {
  return (
    urlObj.host.endsWith('.googlevideo.com') &amp;&amp;
    urlObj.pathname.startsWith('/videoplayback')
  )
}

/**
 * @param {URL} urlObj 
 * @param {number} newLen 
 * @param {Response} res 
 */
async function parseYtVideoRedir(urlObj, newLen, res) {
  if (newLen &gt; 2000) {
    return null
  }
  if (!isYtUrl(urlObj)) {
    return null
  }
  try {
    const data = await res.text()
    urlObj = new URL(data)
  } catch (err) {
    return null
  }
  if (!isYtUrl(urlObj)) {
    return null
  }
  return urlObj
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[注册激活Navicat全系产品的开源代码分享]]></title>
        <id>https://chwl66.github.io/post/GLrSQjpqd</id>
        <link href="https://chwl66.github.io/post/GLrSQjpqd">
        </link>
        <updated>2019-11-22T01:05:56.000Z</updated>
        <content type="html"><![CDATA[<p>前一段儿时间我水了一篇文章介绍了PJ版本的Navicat，当时有大佬PM我，说有一个开源的注册机。当时也没时间测试一直没写文章！</p>
<p>最近几天我的Navicat出问题了，打算新装一下！正好试一试这个开源代码！果然可行！！</p>
<p>博主亲测：Navicat Premium 12.1.22 + Windows 10 X64 激活成功！</p>
<h2 id="开源地址">开源地址</h2>
<p><a href="https://github.com/DoubleLabyrinth/navicat-keygen">https://github.com/DoubleLabyrinth/navicat-keygen</a></p>
<h2 id="软件下载">软件下载</h2>
<p>访问 <a href="https://www.navicat.com.cn/products">https://www.navicat.com.cn/products</a>，选择自己需要的产品点击【免费试用】即可下载软件！</p>
<h2 id="操作过程">操作过程</h2>
<p>1）<a href="https://github.com/DoubleLabyrinth/navicat-keygen/releases">访问地址</a>，下载PJ程序！注意X64的系统要选择X64的软件！</p>
<p>2）将软件包解压，将里面的2个文件复制到D盘！</p>
<p>3）以管理员运行 CMD 命令（<strong>按Win + X，选择 命令提示符（管理员）</strong>）</p>
<p>4）分别执行以下命令！其中第一条命令中引号中的内容伟Navicat安装目录！</p>
<pre><code>navicat-patcher.exe &quot;C:\Program Files\PremiumSoft\Navicat Premium 12&quot;
navicat-keygen.exe -text ./RegPrivateKey.pem
</code></pre>
<p>执行第二条命令后，选择产品和语言以及版本！最后生成一个激活码。</p>
<pre><code>Select Navicat product:
0. DataModeler
1. Premium
2. MySQL
3. PostgreSQL
4. Oracle
5. SQLServer
6. SQLite
7. MariaDB
8. MongoDB
9. ReportViewer
 
(Input index)&amp;gt; 1
 
Select product language:
0. English
1. Simplified Chinese
2. Traditional Chinese
3. Japanese
4. Polish
5. Spanish
6. French
7. German
8. Korean
9. Russian
10. Portuguese
 
(Input index)&amp;gt; 1
 
(Input major version number, range: 0 ~ 15, default: 12)&amp;gt; 12
 
Serial number:
NAVO-2ORP-IN5A-GQEE
</code></pre>
<p>5）启动Navicat程序 – 菜单 – 帮助 – 注册。将序列号填入。</p>
<p>6）电脑断网，然后点击【激活】- 选择【手动激活】会生成请求码</p>
<p>7）将请求码复制到命令提示符框内，按<strong>2</strong>次回车！会生成激活码！</p>
<p>8）将激活码复制到升级框内，点击【激活】，然后激活成功！</p>
<figure data-type="image" tabindex="1"><img src="https://fbi.gs/2019/10/18/5da949517d237.png" alt="img"></figure>
<h2 id="注意事项">注意事项</h2>
<p>1）之前使用其他破解版，需要卸载后重启电脑，然后删除原安装目录。</p>
<p>2）操作过程中错误，从头再来一次即可。</p>
<p>3）PJ输入的组织名不要太长！</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[利用微软 OneDrive API 和腾讯云 SCF 免费搭建个人网盘]]></title>
        <id>https://chwl66.github.io/post/one-scf</id>
        <link href="https://chwl66.github.io/post/one-scf">
        </link>
        <updated>2019-11-21T07:58:47.000Z</updated>
        <content type="html"><![CDATA[<h2 id="scf-简介">SCF 简介</h2>
<p>腾讯云云函数（Serverless Cloud Function，SCF）是腾讯云为企业和开发者们提供的无服务器执行环境，帮助您在无需购买和管理服务器的情况下运行代码，是实时文件处理和数据处理等场景下理想的计算平台。您只需使用 SCF 平台支持的语言编写核心代码并设置代码运行的条件，即可在腾讯云基础设施上弹性、安全地运行代码。</p>
<p>无服务器（Serverless）不是表示没有服务器，而表示当您在使用 Serverless 时，您无需关心底层资源，也无需登录服务器和优化服务器，只需关注最核心的代码片段，即可跳过复杂的、繁琐的基本工作。核心的代码片段完全由事件或者请求触发，平台根据请求自动平行调整服务资源。Serverless 拥有近乎无限的扩容能力，空闲时，不运行任何资源。代码运行无状态，可以轻易实现快速迭代、极速部署。</p>
<p>腾讯云 SCF 目前仍在 <a href="https://cloud.tencent.com/document/product/583/17299">公测</a> 阶段，所有用户可免费使用，结束日期待定。公测结束后，每月仍可享受足量的 <a href="https://cloud.tencent.com/document/product/583/12282">免费资源使用量和免费调用次数</a>，但收取 <code>外网出流量</code> 费用。</p>
<table>
<thead>
<tr>
<th>资源类型</th>
<th>每月免费额度</th>
</tr>
</thead>
<tbody>
<tr>
<td>资源使用量</td>
<td>40 万 GBs</td>
</tr>
<tr>
<td>调用次数</td>
<td>100 万次</td>
</tr>
</tbody>
</table>
<p>所谓外网出流量，即程序通过 SCF 访问外部网络的流量，对于本程序即请求微软 API 的流量，每次调用从几 B 到几 KB 不等；文件上传下载直接与微软交互，不经过 SCF。</p>
<p>下图（老图可能与描述不符）是我一天的使用量，大概调用了 10000 次，如果是 30 天就是 30 万次，还不到免费额度的 1/3。资源使用量 1000 GBs，30 天就是 3 万 GBs，远低于 40 万 GBs。外网出流量 0.05G ，一个月大概是 1.5 G，按照 <a href="https://cloud.tencent.com/document/product/583/12281">正式收费标准</a> 0.8 元 / G，每月要支付 1.2 元的出流量费用，完全可以接受（目前不会收取）。</p>
<figure data-type="image" tabindex="1"><img src="https://img13.360buyimg.com/img/jfs/t1/80717/30/8984/127477/5d6be0f4E2d3ddd41/affd65fa8e220bf2.png" alt="@YL51PJT6NML6PZW{TAI.png"></figure>
<h2 id="获取-onedrive-账号">获取 Onedrive 账号</h2>
<p>既然是利用 Onedrive，首先要获取一个账号，支持个人、企业和教育版。</p>
<h2 id="创建函数服务">创建函数服务</h2>
<p>有了账号后就可以创建函数了。登录 <a href="https://console.cloud.tencent.com/scf/list">腾讯云 SCF 控制台</a>（在此之前要完成腾讯云 <a href="https://cloud.tencent.com/document/product/378/10495">实名认证</a>），点击左侧菜单栏的 <code>函数服务</code>，接着点击顶栏的地区选择下拉框，选择 <code>香港</code>，因为大陆区域在绑定域名时需要备案，如果你拥有已备案的域名，则可以选择国内，当然不绑定域名也可以使用。接着点击蓝色的 <code>新建</code> 按钮，创建函数。</p>
<figure data-type="image" tabindex="2"><img src="https://img12.360buyimg.com/img/jfs/t1/78335/19/8782/41051/5d6b779bEd3525463/c193a7a039e82f6e.png" alt="create_a_function"></figure>
<p>随后在新建函数页面填写 <code>函数名称</code>，名字随意；<code>运行环境</code> 选择 <code>Php 7.2</code>；<code>创建方式</code> 选择 <code>模板函数</code>；选择 <code>helloworld</code> 模板，最后点击最下方的 <code>下一步</code>。进入 <code>② 函数配置</code> 页面后不做任何修改，直接点击 <code>完成</code>。</p>
<figure data-type="image" tabindex="3"><img src="https://img11.360buyimg.com/img/jfs/t1/67123/11/8810/58169/5d6b7c32E1b6db7b4/aac10c9eab43d942.png" alt="GXVWO~RYU4QSIHMEE_{PG.png"></figure>
<h2 id="上传函数代码">上传函数代码</h2>
<p>下载并解压 <a href="https://github.com/qkqpttgf/OneDrive_SCF/archive/master.zip">OneDrive_SCF</a>。随后，进入 SCF <code>函数代码</code> 面板，将 <code>提交方法下拉框</code> 的值改为 <code>本地上传文件夹</code>，随后点击 <code>上传</code>，选择 <code>解压好的文件夹</code>，最后点击 <code>保存</code>。注意，解压后查看一下是否包含两层文件夹，如果是，上传内层。</p>
<figure data-type="image" tabindex="4"><img src="https://img11.360buyimg.com/img/jfs/t1/62901/35/8995/35468/5d6b7f28Eeff3c58a/1d30dd4b9ce9d475.png" alt="D5OFS6O`X7}UTQA.png"></figure>
<h2 id="配置环境变量">配置环境变量</h2>
<p>进入 <code>函数配置</code> 面板，点击靠近右上角的 <code>编辑</code> 按钮。</p>
<figure data-type="image" tabindex="5"><img src="https://img10.360buyimg.com/img/jfs/t1/55934/31/9306/24352/5d6b82a6E03751d6d/22346a7906fb4afb.png" alt="_SP7_T$@DA}LQRVA3SG}44G.png"></figure>
<p>安装前，在环境变量里添加SecretId与SecretKey（在 https://console.cloud.tencent.com/cam/capi 这里生成），获得token后，程序会自动按128字节分开，添加到环境变量的t1-t7(个人帐户只到t4)  在新面板中，将 <code>内存</code> 修改为 <code>512M</code>，当然 64M 也是可以运行的，需要说明的是，内存越大可用的免费时长越少；<code>超时时间</code> 填写 <code>30</code>，随后添加几个环境变量，它们的功能如下：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>含义</th>
<th>备注</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>sitename</td>
<td>站点名称</td>
<td>无</td>
<td>我的网盘</td>
</tr>
<tr>
<td>public_path</td>
<td>要展示的根路径</td>
<td>无</td>
<td>/</td>
</tr>
<tr>
<td>private_path</td>
<td>要展示的根路径</td>
<td>使用自定义域名时必须设置</td>
<td>/</td>
</tr>
<tr>
<td>imgup_path</td>
<td>图床路径</td>
<td>其他网页可以引用上传的图片</td>
<td>/ 图床</td>
</tr>
<tr>
<td>passfile</td>
<td>密码文件名称</td>
<td>在某目录下添加该文件，里面写入密码即可加密文件夹</td>
<td>password.txt</td>
</tr>
<tr>
<td>admin</td>
<td>管理员密码</td>
<td>管理员登录后功能更多</td>
<td>1234</td>
</tr>
<tr>
<td>adminloginpage</td>
<td>管理登录页</td>
<td>登录的页面不再是'?admin'，而是此设置的值。如果设置，登录按钮及页面隐藏</td>
<td></td>
</tr>
</tbody>
</table>
<figure data-type="image" tabindex="6"><img src="https://img13.360buyimg.com/img/jfs/t1/82068/38/8844/46527/5d6b82a8E2b44d81d/3424a3797211a478.png" alt="1J8I6IJD@2J8AIH8WWQ4KM.png"></figure>
<h2 id="添加触发方式">添加触发方式</h2>
<p>进入函数服务的 <code>触发方式</code> 面板，点击 <code>添加触发方式</code>。选择触发方式下拉框中的 <code>API网关触发器</code>，勾选下方的 <code>启用集成响应</code>，点击 <code>保存</code>。</p>
<figure data-type="image" tabindex="7"><img src="https://img14.360buyimg.com/img/jfs/t1/83154/3/8875/52837/5d6b92e5E4b004249/7cbe89ce911aff9f.png" alt="SC6P6_()FK7_IB_S3(}4.png"></figure>
<p>稍等片刻，下方会出现一个 <code>访问路径</code>，点击打开它。</p>
<figure data-type="image" tabindex="8"><img src="https://img10.360buyimg.com/img/jfs/t1/40554/26/13645/35452/5d6b9534E00ac9179/b2977f4e630803b3.png" alt="2UV{Q5H@V13S956@IWG7`2.png"></figure>
<h2 id="关联网盘">关联网盘</h2>
<p>打开页面后，选择OneDrive的版本</p>
<figure data-type="image" tabindex="9"><img src="https://ichwl.xyz/Photo/8863881efd3154055b4eb8a816f474ad.png" alt=""></figure>
<p>确认后等待跳转，在打开的微软账号登录页面中，填写你的 <code>Onedrive 账号和密码</code>，完成登录。</p>
<p>弹出来授权点击接受</p>
<figure data-type="image" tabindex="10"><img src="https://ichwl.xyz/Photo/b6478d500cdfd73d082ca5a0c7b6a0af.png" alt=""></figure>
<p>完成后即会跳转到 <code>refresh token</code> ,系统会自动分段填写 <code>refresh token</code> 到配置中，5s后就会跳转到网盘页面。</p>
<figure data-type="image" tabindex="11"><img src="https://ichwl.xyz/Photo/66f36ebc0b1d695bfb1c3be514e6a0d0.png" alt="C6QSEL5POOL75U"></figure>
<figure data-type="image" tabindex="12"><img src="https://ichwl.xyz/Photo/TIM%E5%9B%BE%E7%89%8720191107153600.png" alt=""></figure>
<h2 id="自定义域名可选">自定义域名（可选）</h2>
<p>进入函数服务的 <code>触发方式</code> 面板，点击打开 <code>SCF_API_SERVICE</code>。</p>
<figure data-type="image" tabindex="13"><img src="https://img14.360buyimg.com/img/jfs/t1/58938/40/9235/37925/5d6b9a15E2a329579/a6ff29214e8578c4.png" alt="_H1UQ7TUS.png"></figure>
<p>打开服务界面的 <code>自定义域名</code> 面板，点击 <code>新建</code>。</p>
<figure data-type="image" tabindex="14"><img src="https://img14.360buyimg.com/img/jfs/t1/75575/7/8907/25412/5d6b9a89E17359d86/9386a93623c95d9b.png" alt="47Q4Z)PLOV{AC@AFFIS5.png"></figure>
<p>在添加域名对话框中，填写你的 <code>域名</code>，<code>协议</code> 选择 <code>http</code>，如果你想使用 <code>https</code>，则必须在腾讯云 <a href="https://cloud.tencent.com/document/product/400/6814">申请或上传 SSL 证书</a>，如果你已经在其他平台申请过推荐直接上传，因为申请一般要等待数小时才能完成。未进行上述操作你看到的 <code>证书下拉框</code> 里将会是<code>无</code>。网络类型勾选 <code>外网</code>。选择 <code>自定义路径映射</code>，添加一条记录，路径为 <code>/</code>，指向 <code>发布</code> 环境。</p>
<figure data-type="image" tabindex="15"><img src="https://img12.360buyimg.com/img/jfs/t1/82337/2/9023/40411/5d6de694E29a550dc/a06d1420f6bdf47e.png" alt="I%G@QBED$T6OJ.png"></figure>
<p>打开你的域名解析服务商控制台，在域名解析列表里添加一条 <a href="https://cloud.tencent.com/document/product/302/3450">CNAME 记录</a>，值便是图中上方的 <code>外网二级域名</code>。最后点击 <code>提交</code>。</p>
<p>进入 <code>管理 API</code> 面板，点击 <code>编辑</code>。</p>
<figure data-type="image" tabindex="16"><img src="https://img12.360buyimg.com/img/jfs/t1/75724/35/9137/30365/5d6de5bbEbebf6709/ecf9149ecd869df3.png" alt="7K.png"></figure>
<p>在 <code>前端配置</code> 面板中，将路径改为 <code>/</code>，点击下一步。</p>
<figure data-type="image" tabindex="17"><img src="https://img11.360buyimg.com/img/jfs/t1/81276/18/9151/53670/5d6de5bdE22b67bd0/f9323a6cca49f732.png" alt="MU0D8F.png"></figure>
<p>在 <code>后端配置</code> 中，保证已勾选 <code>启用集成响应</code> 后点击 <code>下一步</code>。</p>
<figure data-type="image" tabindex="18"><img src="https://img11.360buyimg.com/img/jfs/t1/77289/11/9087/26551/5d6de5c2Eaf31705b/5950b12c8261ecd7.png" alt="TZDO.png"></figure>
<p>在 <code>响应结果</code> 面板，将 <code>返回类型</code> 改为 <code>HTML</code>，点击 <code>完成</code>。</p>
<figure data-type="image" tabindex="19"><img src="https://img12.360buyimg.com/img/jfs/t1/49932/13/9445/26534/5d6de5c4Eaa7582f4/7efa4f81442852c7.png" alt="afaPU.png"></figure>
<p>在弹出的对话框中，点击 <code>前往发布服务</code>。</p>
<figure data-type="image" tabindex="20"><img src="https://img14.360buyimg.com/img/jfs/t1/77585/36/9012/22830/5d6de5c6Ea2ee3023/70320d81116e8c26.png" alt="fafadfEGM.png"></figure>
<p>在 <code>服务信息</code> 面板，点击靠近 <code>右上角</code> 的 <code>发布</code> 按钮。</p>
<figure data-type="image" tabindex="21"><img src="https://img12.360buyimg.com/img/jfs/t1/72692/38/9030/27078/5d6de5c8E56e8d3f7/37da68d26c44f8d1.png" alt="fafadUHOH8MI5.png"></figure>
<p>在弹出的 <code>发布服务</code> 对话框中，将 <code>发布环境</code> 改为 <code>发布</code>，<code>备注</code> 随意填写，最后点击 <code>提交</code>。</p>
<figure data-type="image" tabindex="22"><img src="https://img12.360buyimg.com/img/jfs/t1/49295/10/9605/23935/5d6de5caE43782e1b/f1b36f0d54f8277b.png" alt="8WBC7C0UQfadf.png"></figure>
<p>现在就可以通过自定义域名访问你的网盘了。</p>
<h2 id="使用-github-pages-缩短长链接可选">使用 Github Pages 缩短长链接（可选）</h2>
<p>如果你没有域名和服务器，可以通过 Github Pages 跳转的方式，适当缩短首次访问的路径长度，最终可以通过 <code>username.github.io</code> 打开你的网盘。</p>
<p>注册并登录 <a href="https://github.com/join">Github</a>，随后打开 <a href="https://github.com/vcheckzen/redirect">该仓库</a>，点击靠近右上角的 <code>Fork</code>。稍等片刻，打开页面中部的 <code>index.html</code>。</p>
<figure data-type="image" tabindex="23"><img src="https://img13.360buyimg.com/img/jfs/t1/81433/29/9011/43730/5d6ba364E8bfbcab9/922db430228cc015.png" alt="YSG)}(}WF$V6(I8Z(RF7FK.png"></figure>
<p>点击靠近 <code>右上角</code> 的 <code>铅笔</code> 按钮，编辑该文件。</p>
<figure data-type="image" tabindex="24"><img src="https://img12.360buyimg.com/img/jfs/t1/48643/27/9492/22737/5d6decd0E59609187/345f9d14fe3de9d1.png" alt="fafdafdafQA.png"></figure>
<p>将你的 <code>函数 API 网关访问路径</code> 替换到文件中。</p>
<figure data-type="image" tabindex="25"><img src="https://img12.360buyimg.com/img/jfs/t1/82296/16/7071/26718/5d6ba424Eeb8963e6/75e9725b397a3b7d.png" alt="%{(U9@D`9.png"></figure>
<p>修改完毕后点击靠近页面最下方的 <code>Commit changes</code>。</p>
<figure data-type="image" tabindex="26"><img src="https://img13.360buyimg.com/img/jfs/t1/46300/14/9374/21791/5d6ba442E58d82ba6/72e92de2f4ad12f1.png" alt="`56PL$O1D}(V2P@4WR%P6B.png"></figure>
<p>点击靠近右上角的 <code>Settings</code>，将 <code>Repository name</code> 改成 <code>你的 Github 用户名.github.io</code>，随后点击 <code>Rename</code>。</p>
<figure data-type="image" tabindex="27"><img src="https://img12.360buyimg.com/img/jfs/t1/73876/14/8917/49824/5d6ba654E9c44470a/539d599e20d5e705.png" alt="@(S16VV$)48~O8MHD6KYB5D.png"></figure>
<p>下拉该页面，找到 <code>Github Pages</code>，将 <code>Source</code> 下拉框的值改成 <code>master branch</code>，如果没有则无需修改。</p>
<figure data-type="image" tabindex="28"><img src="https://img12.360buyimg.com/img/jfs/t1/43663/2/13575/33132/5d6ba655E9e64f8c4/b8a6c84311f74234.png" alt="}`R6~2N@)LINVXYJ5LEP59.png"></figure>
<p>现在，就可以通过 <code>你的 Github 用户名.github.io</code> 访问网盘了。</p>
]]></content>
    </entry>
</feed>